/* ButtonProductImagesHandler.js <?php
#   --------------------------------------------------------------
#   ButtonProductImagesHandler.js 2016-11-04
#   Gambio GmbH
#   http://www.gambio.de
#   Copyright (c) 2016 Gambio GmbH
#   Released under the GNU General Public License (Version 2)
#   [http://www.gnu.org/licenses/gpl-2.0.html]
#   --------------------------------------------------------------
?>*/
/*<?php
if($GLOBALS['coo_debugger']->is_enabled('uncompressed_js') == false)
{
?>*/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('8 1A(i,j,k){4(t)u.v(\'1A 2q\');r l=A;4(1h(i)==\'1Z\'){l=i}r m=A;4(1h(j)==\'1Z\'){m=j}r n=2r;4(20(k)!=\'2s\'){n=20(k)}r o=5,1i=0,15=1j 2t(),1k=A,1l=p,1B=0,16=\'\',1C=\'\';5.1b=8(){4(t)u.v(\'1A 1b\');5.1D();4(m){5.1E()}4(l){5.1F()}M{$(\'.17\').H(\'z\');$(\'.17\').I(\'z\',8(){4(t)u.v(\'.17 z\');4($(\'.s .x .y #R\').F>0&&$(\'.s .x .y #R\').7(\'1c\')!=\'1d\'){o.1e(5)}S p})}};5.1D=8(){4(t)u.v(\'1D\');r a=\'\';$(\'a.10\').H(\'T\');$(\'a.10\').I(\'T\',8(){4(t)u.v(\'a.10 T: \'+$(5).q(\'U\'));$(5).q(\'1m\',\'\');$(5).2u(\'21\').q(\'1m\',\'\');4($(\'.s .x .y #R\').F==0||$(\'.s .x .y #R\').7(\'1c\')==\'1d\'){16=\'#\'+$(5).q(\'U\');4(1l==p){o.1e(5)}}S p});$(\'.10\').H(\'W\');$(\'.10\').I(\'W\',8(){22(1i);4($(\'.s .x .y .J\').X()==\'1n...\'){$(\'.s .x .y .J\').X(1C);o.1b()}2v(1B);16=\'\';1l=A;1B=2w(o.1o,n);a=$(5).q(\'U\');a=a.w(\'1G\',\'\');$(\'.s .x .y #23\'+a).2x(\'a\').K(\'24\');S p})};5.1o=8(){1l=p;4(16!=\'\'){4(t)u.v(\'1o(): \'+16);o.1e(16)}M{4(t)u.v(\'1o(): 2y 2z\')}};5.1e=8(a){4(1h($(a).q(\'U\'))!=\'25\'&&$(a).q(\'U\').11(\'1G\')!=-1){$(\'.s .x .y #R\').26();$(\'a.10\').K(\'1H\');$(a).V(\'1H\');12=$(a).q(\'U\');12=12.w(\'1G\',\'\');15[12]=1j 27();15[12].1p=$(a).q(\'G\');28=5.1I(12,$(a).q(\'29\'));4(28==p){1i=2A(8(){o.1I(12,$(a).q(\'29\'))},2a)}}};5.1I=8(a,b){r c=N(a),1q=A;4(15[c].2B!=A){1q=p}4(1q){22(1i);r d=\'\';4(l==p){d=\' 1J="2C: 2D;"\'}r e=15[c].1p;e=e.2E(e.11(2F.2G.2H+\'2I\'),e.F);$(\'.s .x .y .J\').7(\'Y\',15[c].Y+\'E\');$(\'.s .x .y .J\').X(\'<a 2b="24" G="\'+b+\'"\'+d+\' 1m=""><21 U="23\'+c+\'" 1p="\'+e+\'" 2J="" 1m="" /></a>\');4(m){5.1E()}}M{4($(\'.s .x .y .J\').X()!=\'1n...\'){1C=$(\'.s .x .y .J\').X()}$(\'.s .x .y .J\').X(\'1n...\');4(t)u.v(\'1n 2K...\')}S 1q};5.1E=8(){4($(\'.s .x .y #R\').F==0||$(\'.s .x .y #R\').7(\'1c\')==\'1d\'){$(\'.s .x .y .J\').X($(\'.s .x .y .J\').X());4($(".J").F>0){$(".J").2L()}}};5.1F=8(){4(t)u.v(\'1F\');$(\'.17\').H(\'z\');$(\'.17\').I(\'z\',8(){4(t)u.v(\'.17 z\');4($(\'.s .x .y #R\').F>0&&$(\'.s .x .y #R\').7(\'1c\')!=\'1d\'){o.1e(5)}M 4($(\'.s .x .y .J\').F>0){$(\'.2M\').2N(\'<1r U="1s"></1r>\');$(\'#1s\').7({2O:\'2P\',1t:\'2Q\',1K:\'2R\',Y:\'2a%\'});$(\'#1s\').2S(\'2T.2U?2V=2W&U=\'+$("#2X").q(\'2Y\')+\'&2Z=\'+30,8(a){o.2c();o.2d()});4(31.32.33(/34 [0-6]\\./)){$(\'.35\').7({18:\'1L\'})}1M.36(\'#1s\');$(\'#37\').7({1c:\'1d\'});4($(2e).13()>$(\'#2f\').13()){r b=$(2e).13()}M{r b=$(\'#2f\').13()+38}$(\'#39\').7({13:b+\'E\'})}S p})};5.2c=8(){4(t)u.v(\'s 1b\');r c=N($(\'#B\').7(\'13\').w(\'E\',\'\')),1N=0;4($(\'#B .19:2g\').F>0){1N=N($(\'#B .19:2g\').7(\'13\').w(\'E\',\'\'))}r d=1O.2h(c/2)-1O.2h(1N/2);$(\'#B .19\').2i(\'<1r 1J="1P-1K:\'+d+\'E;2j:1t;" />\');$(\'#B .1u\').2i(\'<1r 1J="1P-1K:\'+d+\'E;2j:1v;" />\');$(\'#3\').H(\'1Q\');$(\'#3\').I(\'1Q\',8(){4(t)u.v(\'#3 1Q\');1k=p});$(\'#3\').H(\'1R\');$(\'#3\').I(\'1R\',8(){4(t)u.v(\'#3 1R\');1k=A});$(\'3a\').z(8(){4(1k&&1h(3b)==\'25\'){1M.2k()}});r e=0,1w=N($(\'#3 .9\').7(\'Y\').w(\'E\',\'\'))+N($(\'#3 .9\').7(\'1P-1v\').w(\'E\',\'\'))+N($(\'#3 .9\').7(\'2l-1t\').w(\'E\',\'\'))+N($(\'#3 .9\').7(\'2l-1v\').w(\'E\',\'\'))+N($(\'#3 .9\').7(\'2m-1t-Y\').w(\'E\',\'\'))+N($(\'#3 .9\').7(\'2m-1v-Y\').w(\'E\',\'\')),1S=N($(\'#3\').7(\'Y\').w(\'E\',\'\'));e=$(\'#3 .9\').F*1w;4(1S<e){r f=1O.3c(1S/1w);e=f*1w}$(\'#1T\').7(\'Y\',e+\'E\');r g=0,14=0;$(\'.s .3d .10\').1x(8(){4($(5).q(\'2b\').11(\'1H\')!=-1){g=14}14++});$(\'#B\').7(\'O-P\',\'Q("\'+$(\'#3 .9 a\').Z(g).q(\'G\')+\'")\');$(\'#3 .9\').Z(g).V(\'L\');$(\'#3 .9 a\').H(\'z\');$(\'#3 .9 a\').I(\'z\',8(){4(t)u.v(\'#3 .9 a z\');$(\'#3 .9\').K(\'L\');$(5).1f().V(\'L\');r a=$(5).q(\'G\');$(\'#B\').7(\'O-P\',\'Q("\'+a+\'")\');o.1g(A);S p});$(\'#3 .C, #3 .C a\').2n(\'z\');$(\'#3 .C, #3 .C a\').z(8(){4(t)u.v(\'#3 .C, #3 .C a z\');r b=2o($(\'#B\').7(\'O-P\').w(\'Q("\',\'\').w(\'")\',\'\')),1y=\'\',1U=3e,1a=p;$(\'#3 .9 a\').1x(8(){r a=$(5).q(\'G\').2p(\'?\')[0].w(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,"\\\\$&");4(b.11(a)!=-1){4(1y!=\'\'){$(\'#B\').7(\'O-P\',\'Q("\'+1y+\'")\');$(\'#3 .9\').K(\'L\');$(1U).1f().V(\'L\');1a=A}}M{1y=$(5).q(\'G\');1U=5}});4(1a==p){$(\'#B\').7(\'O-P\',\'Q("\'+$(\'#3 .9 a\').Z($(\'#3 .9 a\').F-1).q(\'G\')+\'")\');$(\'#3 .9\').K(\'L\');$(\'#3 .9 a\').Z($(\'#3 .9 a\').F-1).1f().V(\'L\')}o.1g(A);S p});$(\'#3 .D, #3 .D a\').2n(\'z\');$(\'#3 .D, #3 .D a\').z(8(){4(t)u.v(\'#3 .D, #3 .D a z\');r b=2o($(\'#B\').7(\'O-P\').w(\'Q("\',\'\').w(\'")\',\'\')),1z=p,1a=p;$(\'#3 .9 a\').1x(8(){4(1z==A){$(\'#B\').7(\'O-P\',\'Q("\'+$(5).q(\'G\')+\'")\');$(\'#3 .9\').K(\'L\');$(5).1f().V(\'L\');1z=p;1a=A}r a=$(5).q(\'G\').2p(\'?\')[0].w(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,"\\\\$&");4(b.11(a)!=-1){1z=A}});4(1a==p){$(\'#B\').7(\'O-P\',\'Q("\'+$(\'#3 .9 a\').Z(0).q(\'G\')+\'")\');$(\'#3 .9\').K(\'L\');$(\'#3 .9 a\').Z(0).1f().V(\'L\')}o.1g(A);S p});r h=p;$(\'#3 .C\').H(\'T\');$(\'#3 .C\').I(\'T\',8(){4(t)u.v(\'#3 .C T\');4(!h){$(\'.19\').V(\'1V\');$(\'.1u\').K(\'1W\')}});$(\'#3 .C\').H(\'W\');$(\'#3 .C\').I(\'W\',8(){4(t)u.v(\'#3 .C W\');$(\'.19\').K(\'1V\')});$(\'#3 .D\').H(\'T\');$(\'#3 .D\').I(\'T\',8(){4(t)u.v(\'#3 .D T\');h=A;$(\'.1u\').V(\'1W\');$(\'.19\').K(\'1V\')});$(\'#3 .D\').H(\'W\');$(\'#3 .D\').I(\'W\',8(){4(t)u.v(\'#3 .D W\');h=p;$(\'.1u\').K(\'1W\')});$(\'#3 .1X\').H(\'z\');$(\'#3 .1X\').I(\'z\',8(){4(t)u.v(\'#3 .1X z\');1M.2k();S p});o.1g(A)};5.1g=8(a){4(a==p){4($(\'#B\').7(\'O-P\').w(\'Q("\',\'\').w(\'")\',\'\').11($(\'#3 .9 a\').Z(0).q(\'G\'))!=-1){$(\'#3 .C\').7(\'18\',\'1L\')}M{$(\'#3 .C\').7(\'18\',\'1Y\')}4($(\'#B\').7(\'O-P\').w(\'Q("\',\'\').w(\'")\',\'\').11($(\'#3 .9 a\').Z($(\'#3 .9 a\').F-1).q(\'G\'))!=-1){$(\'#3 .D\').7(\'18\',\'1L\')}M{$(\'#3 .D\').7(\'18\',\'1Y\')}}M{4($(\'#1T .9\').F>1){$(\'#3 .C, #3 .D\').7(\'18\',\'1Y\')}M{$(\'#1T\').26()}}};5.2d=8(){r a=1j 3f(),14=0;$(\'#3 .9 a\').1x(8(){a[14]=1j 27();a[14].1p=$(5).q(\'G\');14++})};5.1b()}',62,202,'|||lightbox_gallery|if|this||css|function|thumbnail||||||||||||||||false|attr|var|gallery|fb|console|log|replace|inside|stage|click|true|lightbox_gallery_main|lightbox_gallery_left|lightbox_gallery_right|px|length|href|die|live|info_image_box|removeClass|lightbox_thumbnail_active|else|Number|background|image|url|crossslide|return|mouseover|id|addClass|mouseout|html|width|eq|button_product_images|search|t_thumbnail_id|height|count_thumbnails|t_images_array|t_active_image_id|button_lightbox_gallery|visibility|icon_gallery_back|t_updated_image|init_binds|display|none|show_image|parent|update_navigation|typeof|t_interval|new|t_close_lightbox|t_wait|title|loading|show_image_after_delay|src|t_image_loaded|div|lightbox_gallery_box|left|icon_gallery_next|right|t_thumbnail_width|each|t_previous_image|t_current_image_reached|ButtonProductImagesHandler|t_timeout|t_last_image_html|bind_thumbnails|bind_zoom|bind_lightbox|gallery_inside_thumbnail_|active_thumbnail|load_image|style|top|hidden|gmLightBox|t_button_height|Math|margin|mouseenter|mouseleave|t_gallery_width|lightbox_gallery_thumbnails|t_previous_element|icon_gallery_back_active|icon_gallery_next_active|icon_lightbox_close|visible|boolean|parseInt|img|clearInterval|gallery_inside_main_|jqzoom|undefined|hide|Image|t_load_image|rel|100|class|gallery_init_binds|preload|document|popup_box|first|round|wrap|float|close_box|padding|border|unbind|decodeURI|split|ready|500|NaN|Object|find|clearTimeout|setTimeout|closest|no|element|setInterval|complete|cursor|default|substring|js_options|global|dir_ws_images|product_images|alt|images|zoom_plugin|wrap_shop|append|position|absolute|0px|60px|load|request_port|php|module|LightboxGallery|gm_products_id|value|XTCsid|gm_session_id|navigator|appVersion|match|MSIE|lightbox_visibility_hidden|load_box|menubox_gm_scroller|200|__dimScreen|body|gm_style_edit_mode_running|floor|thumbnails|null|Array'.split('|'),0,{}));
/*<?php
}
else
{
?>*/
function ButtonProductImagesHandler(p_lightbox, p_zoom, p_delay)
{
	if(fb)console.log('ButtonProductImagesHandler ready');

	var t_lightbox = true;
	if(typeof(p_lightbox) == 'boolean')
	{
		t_lightbox = p_lightbox;
	}
	var t_zoom = true;
	if(typeof(p_zoom) == 'boolean')
	{
		t_zoom = p_zoom;
	}
	var t_delay = 500;
	if(parseInt(p_delay) != 'NaN')
	{
		t_delay = parseInt(p_delay);
	}

	var coo_this = this;
	var t_interval = 0;
	var t_images_array = new Object();
	var t_close_lightbox = true;
	var t_wait = false;
	var t_timeout = 0;
	var t_active_image_id = '';
	var t_last_image_html = '';


	this.init_binds = function()
	{
		if(fb)console.log('ButtonProductImagesHandler init_binds');

		this.bind_thumbnails();
		if(t_zoom)
		{
			this.bind_zoom();
		}
		if(t_lightbox)
		{
			this.bind_lightbox();
		}
		else
		{
			$('.button_lightbox_gallery').die('click');
			$('.button_lightbox_gallery').live('click', function()
			{
				if(fb)console.log('.button_lightbox_gallery click');

				if($('.gallery .inside .stage #crossslide').length > 0 && $('.gallery .inside .stage #crossslide').css('display') != 'none')
				{
					coo_this.show_image(this);
				}

				return false;
			});
		}
	}


	this.bind_thumbnails = function()
	{
		if(fb)console.log('bind_thumbnails');

		var t_thumbnail_id = '';

		$('a.button_product_images').die('mouseover');
		$('a.button_product_images').live('mouseover', function()
		{
			if(fb)console.log('a.button_product_images mouseover: ' + $(this).attr('id'));

			$(this).attr('title', '');
			$(this).find('img').attr('title', '');

			if($('.gallery .inside .stage #crossslide').length == 0 || $('.gallery .inside .stage #crossslide').css('display') == 'none')
			{
				t_active_image_id = '#' + $(this).attr('id');

				if(t_wait == false)
				{
					coo_this.show_image(this);
				}

			}

			return false;
		});

		$('.button_product_images').die('mouseout');
		$('.button_product_images').live('mouseout', function()
		{
			clearInterval(t_interval);
			
			if($('.gallery .inside .stage .info_image_box').html() == 'loading...')
			{
				$('.gallery .inside .stage .info_image_box').html(t_last_image_html);
				coo_this.init_binds();
			}

			clearTimeout(t_timeout);
			t_active_image_id = '';
			t_wait = true;
			t_timeout = setTimeout(coo_this.show_image_after_delay, t_delay);

			t_thumbnail_id = $(this).attr('id');
			t_thumbnail_id = t_thumbnail_id.replace('gallery_inside_thumbnail_', '');

			$('.gallery .inside .stage #gallery_inside_main_' + t_thumbnail_id).closest('a').removeClass('jqzoom');


			return false;
		});
	}


	this.show_image_after_delay = function()
	{
		t_wait = false;

		if(t_active_image_id != '')
		{
			if(fb)console.log('show_image_after_delay(): ' + t_active_image_id);
			coo_this.show_image(t_active_image_id);
		}
		else
		{
			if(fb)console.log('show_image_after_delay(): no element');
		}
	}


	this.show_image = function(p_element)
	{
		if(typeof($(p_element).attr('id')) != 'undefined' && $(p_element).attr('id').search('gallery_inside_thumbnail_') != -1)
		{
			$('.gallery .inside .stage #crossslide').hide();

			$('a.button_product_images').removeClass('active_thumbnail');
			$(p_element).addClass('active_thumbnail');

			t_thumbnail_id = $(p_element).attr('id');
			t_thumbnail_id = t_thumbnail_id.replace('gallery_inside_thumbnail_', '');

			t_images_array[t_thumbnail_id] = new Image();

			t_images_array[t_thumbnail_id].src = $(p_element).attr('href');

			t_load_image = this.load_image(t_thumbnail_id, $(p_element).attr('rel'));

			if(t_load_image == false)
			{
				t_interval = setInterval(function(){coo_this.load_image(t_thumbnail_id, $(p_element).attr('rel'));}, 100);
			}
		}
	}


	this.load_image = function(p_id, p_zoom_url)
	{
		var c_id = Number(p_id);

		var t_image_loaded = true;
		if(t_images_array[c_id].complete != true)
		{
			t_image_loaded = false;
		}

		if(t_image_loaded)
		{
			clearInterval(t_interval);

			var t_style = '';
			if(t_lightbox == false)
			{
				t_style = ' style="cursor: default;"';
			}

			// create relative image path, to avoid problems with umlaut domains
			var t_image_url = t_images_array[c_id].src;
			t_image_url = t_image_url.substring(t_image_url.search(js_options.global.dir_ws_images + 'product_images'), t_image_url.length);

			$('.gallery .inside .stage .info_image_box').css('width', t_images_array[c_id].width + 'px');
			$('.gallery .inside .stage .info_image_box').html('<a class="jqzoom" href="' + p_zoom_url + '"' + t_style + ' title=""><img id="gallery_inside_main_' + c_id + '" src="' + t_image_url + '" alt="" title="" /></a>');

			if(t_zoom)
			{
				this.bind_zoom();
			}
		}
		else
		{
			if($('.gallery .inside .stage .info_image_box').html() != 'loading...')
			{
				t_last_image_html = $('.gallery .inside .stage .info_image_box').html();
			}
			$('.gallery .inside .stage .info_image_box').html('loading...');
			if(fb)console.log('loading images...');
		}

		return t_image_loaded;
	}


	this.bind_zoom = function()
	{
    
		if($('.gallery .inside .stage #crossslide').length == 0 || $('.gallery .inside .stage #crossslide').css('display') == 'none')
		{
			// workaround for chrome browser
			$('.gallery .inside .stage .info_image_box').html($('.gallery .inside .stage .info_image_box').html());

			if($(".info_image_box").length > 0)
			{
				$(".info_image_box").zoom_plugin();
			}
		}
	}


	this.bind_lightbox = function()
	{
		if(fb)console.log('bind_lightbox');

		$('.button_lightbox_gallery').die('click');
		$('.button_lightbox_gallery').live('click', function()
		{
			if(fb)console.log('.button_lightbox_gallery click');

			if($('.gallery .inside .stage #crossslide').length > 0 && $('.gallery .inside .stage #crossslide').css('display') != 'none')
			{
				coo_this.show_image(this);
			}
			else if($('.gallery .inside .stage .info_image_box').length > 0)
			{
				$('.wrap_shop').append('<div id="lightbox_gallery_box"></div>');

				$('#lightbox_gallery_box').css(
				{
					position: 	'absolute',
					left: 			'0px',
					top: 				'60px',
					width: 			'100%'
				});

				$('#lightbox_gallery_box').load('request_port.php?module=LightboxGallery&id=' + $("#gm_products_id").attr('value') + '&XTCsid=' + gm_session_id,
					function(lightbox_gallery)
					{
						coo_this.gallery_init_binds();
						coo_this.preload();
					}
				);

				if (navigator.appVersion.match(/MSIE [0-6]\./)) {
					$('.lightbox_visibility_hidden').css(
					{
						visibility: 	'hidden'
					});
				}

				gmLightBox.load_box('#lightbox_gallery_box');
				// BOF MOD by PT
				$('#menubox_gm_scroller').css({
					display: 'none'
				});

				if($(document).height() > $('#popup_box').height()) {
					var pt_height = $(document).height();
				} else {
					var pt_height = $('#popup_box').height() + 200;
				}
				$('#__dimScreen').css({height: pt_height + 'px'});
				// EOF MOD by PT
			}

			return false;
		});
	}

	this.gallery_init_binds = function()
	{
		if(fb)console.log('gallery init_binds');

		var t_main_height = Number($('#lightbox_gallery_main').css('height').replace('px', ''));
		var t_button_height = 0;
		if($('#lightbox_gallery_main .icon_gallery_back:first').length > 0)
		{
			t_button_height = Number($('#lightbox_gallery_main .icon_gallery_back:first').css('height').replace('px', ''));
		}
		var t_margin_top = Math.round(t_main_height / 2) - Math.round(t_button_height / 2);

		$('#lightbox_gallery_main .icon_gallery_back').wrap('<div style="margin-top:' +  t_margin_top + 'px;float:left;" />');
		$('#lightbox_gallery_main .icon_gallery_next').wrap('<div style="margin-top:' +  t_margin_top + 'px;float:right;" />');

		$('#lightbox_gallery').die('mouseenter');
		$('#lightbox_gallery').live('mouseenter', function()
		{
			if(fb)console.log('#lightbox_gallery mouseenter');

			t_close_lightbox = false;
		});

		$('#lightbox_gallery').die('mouseleave');
		$('#lightbox_gallery').live('mouseleave', function()
		{
			if(fb)console.log('#lightbox_gallery mouseleave');

			t_close_lightbox = true;
		});

		$('body').click(function()
		{
			if(t_close_lightbox && typeof(gm_style_edit_mode_running) == 'undefined')
			{
				gmLightBox.close_box();
			}
		});

		// centering thumbnails
		var t_thumbnails_width = 0;
		var t_thumbnail_width = Number($('#lightbox_gallery .thumbnail').css('width').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('margin-right').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('padding-left').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('padding-right').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('border-left-width').replace('px', ''))
								+ Number($('#lightbox_gallery .thumbnail').css('border-right-width').replace('px', ''));
		var t_gallery_width = Number($('#lightbox_gallery').css('width').replace('px', ''));
		t_thumbnails_width = $('#lightbox_gallery .thumbnail').length * t_thumbnail_width;
		if(t_gallery_width < t_thumbnails_width)
		{
			var t_thumbnails_per_row = Math.floor(t_gallery_width / t_thumbnail_width);
			t_thumbnails_width = t_thumbnails_per_row * t_thumbnail_width;
		}
		$('#lightbox_gallery_thumbnails').css('width', t_thumbnails_width + 'px');

		var t_active_image = 0;
		var count_thumbnails = 0;
		$('.gallery .thumbnails .button_product_images').each(function()
		{
			if($(this).attr('class').search('active_thumbnail') != -1)
			{
				t_active_image = count_thumbnails;
			}

			count_thumbnails++;
		});

		$('#lightbox_gallery_main').css('background-image', 'url("' + $('#lightbox_gallery .thumbnail a').eq(t_active_image).attr('href') + '")');
		$('#lightbox_gallery .thumbnail').eq(t_active_image).addClass('lightbox_thumbnail_active');

		$('#lightbox_gallery .thumbnail a').die('click');
		$('#lightbox_gallery .thumbnail a').live('click', function()
		{
			if(fb)console.log('#lightbox_gallery .thumbnail a click');

			$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
			$(this).parent().addClass('lightbox_thumbnail_active');

			var t_popup_image_url = $(this).attr('href');
			$('#lightbox_gallery_main').css('background-image', 'url("' + t_popup_image_url + '")');

			coo_this.update_navigation(true);

			return false;
		});

		$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a').unbind('click');
		$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a').click(function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_left a click');

			var t_current_image = decodeURI($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', ''));
			var t_previous_image = '';
			var t_previous_element = null;
			var t_updated_image = false;

			$('#lightbox_gallery .thumbnail a').each(function()
			{
				var search_string = $(this).attr('href').split('?')[0].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
				
				if(t_current_image.search(search_string) != -1)
				{
					if(t_previous_image != '')
					{
						$('#lightbox_gallery_main').css('background-image', 'url("' + t_previous_image + '")');

						$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
						$(t_previous_element).parent().addClass('lightbox_thumbnail_active');

						t_updated_image = true;
					}
				}
				else
				{
					t_previous_image = $(this).attr('href');
					t_previous_element = this;
				}
			});

			if(t_updated_image == false)
			{
				$('#lightbox_gallery_main').css('background-image', 'url("' + $('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length - 1).attr('href') + '")');

				$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
				$('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length - 1).parent().addClass('lightbox_thumbnail_active');
			}

			coo_this.update_navigation(true);

			return false;
		});

		$('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a').unbind('click');
		$('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a').click(function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right, #lightbox_gallery .lightbox_gallery_right a click');

			var t_current_image = decodeURI($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', ''));
			var t_current_image_reached = false;
			var t_updated_image = false;

			$('#lightbox_gallery .thumbnail a').each(function()
			{
				if(t_current_image_reached == true)
				{
					$('#lightbox_gallery_main').css('background-image', 'url("' + $(this).attr('href') + '")');

					$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
					$(this).parent().addClass('lightbox_thumbnail_active');

					t_current_image_reached = false;
					t_updated_image = true;
				}
				
				var search_string = $(this).attr('href').split('?')[0].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
				
				if(t_current_image.search(search_string) != -1)
				{
					t_current_image_reached = true;
				}
			});

			if(t_updated_image == false)
			{
				$('#lightbox_gallery_main').css('background-image', 'url("' + $('#lightbox_gallery .thumbnail a').eq(0).attr('href') + '")');

				$('#lightbox_gallery .thumbnail').removeClass('lightbox_thumbnail_active');
				$('#lightbox_gallery .thumbnail a').eq(0).parent().addClass('lightbox_thumbnail_active');
			}

			coo_this.update_navigation(true);

			return false;
		});

		var t_right_mouseover = false;

		// BOF previous image
		$('#lightbox_gallery .lightbox_gallery_left').die('mouseover');
		$('#lightbox_gallery .lightbox_gallery_left').live('mouseover', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left mouseover');

			if(!t_right_mouseover)
			{
				$('.icon_gallery_back').addClass('icon_gallery_back_active');
				$('.icon_gallery_next').removeClass('icon_gallery_next_active');
			}
		});

		$('#lightbox_gallery .lightbox_gallery_left').die('mouseout');
		$('#lightbox_gallery .lightbox_gallery_left').live('mouseout', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_left mouseout');

			$('.icon_gallery_back').removeClass('icon_gallery_back_active');
		});
		// EOF previous image

		// BOF next image
		$('#lightbox_gallery .lightbox_gallery_right').die('mouseover');
		$('#lightbox_gallery .lightbox_gallery_right').live('mouseover', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right mouseover');

			t_right_mouseover = true;

			$('.icon_gallery_next').addClass('icon_gallery_next_active');
			$('.icon_gallery_back').removeClass('icon_gallery_back_active');
		});

		$('#lightbox_gallery .lightbox_gallery_right').die('mouseout');
		$('#lightbox_gallery .lightbox_gallery_right').live('mouseout', function()
		{
			if(fb)console.log('#lightbox_gallery .lightbox_gallery_right mouseout');

			t_right_mouseover = false;

			$('.icon_gallery_next').removeClass('icon_gallery_next_active');
		});
		// EOF next image

		// BOF close
		$('#lightbox_gallery .icon_lightbox_close').die('click');
		$('#lightbox_gallery .icon_lightbox_close').live('click', function()
		{
			if(fb)console.log('#lightbox_gallery .icon_lightbox_close click');

			gmLightBox.close_box();

			return false;
		});
		// EOF close

		coo_this.update_navigation(true);
	}


	this.update_navigation = function(p_loop)
	{
		if(p_loop == false)
		{
			if($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '').search($('#lightbox_gallery .thumbnail a').eq(0).attr('href')) != -1)
			{
				$('#lightbox_gallery .lightbox_gallery_left').css('visibility', 'hidden');
			}
			else
			{
				$('#lightbox_gallery .lightbox_gallery_left').css('visibility', 'visible');
			}

			if($('#lightbox_gallery_main').css('background-image').replace('url("', '').replace('")', '').search($('#lightbox_gallery .thumbnail a').eq($('#lightbox_gallery .thumbnail a').length-1).attr('href')) != -1)
			{
				$('#lightbox_gallery .lightbox_gallery_right').css('visibility', 'hidden');
			}
			else
			{
				$('#lightbox_gallery .lightbox_gallery_right').css('visibility', 'visible');
			}
		}
		else
		{
			if($('#lightbox_gallery_thumbnails .thumbnail').length > 1)
			{
				$('#lightbox_gallery .lightbox_gallery_left, #lightbox_gallery .lightbox_gallery_right').css('visibility', 'visible');
			}
			else
			{
				$('#lightbox_gallery_thumbnails').hide();
			}
		}
	}

	this.preload = function()
	{
		var t_images = new Array();
		var count_thumbnails = 0;

		$('#lightbox_gallery .thumbnail a').each(function()
		{
			t_images[count_thumbnails] = new Image();
			t_images[count_thumbnails].src = $(this).attr('href');

			count_thumbnails++;
		});
	}

	this.init_binds();
}
/*<?php
}
?>*/
